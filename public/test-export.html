<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Batch Export</title>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  <script>
    // Sample batch data for testing
    const batches = [
      {
        id: 1,
        name: "Test Batch",
        status: "training",
        capacityLimit: 20,
        location: { name: "Noida" },
        process: { name: "Customer Support" },
        line_of_business: { name: "Finance" },
        startDate: "2025-03-15T00:00:00.000Z",
        inductionStartDate: "2025-03-15T00:00:00.000Z",
        inductionEndDate: "2025-03-20T00:00:00.000Z",
        trainingStartDate: "2025-03-21T00:00:00.000Z",
        trainingEndDate: "2025-03-31T00:00:00.000Z",
        actual_induction_start_date: "2025-03-15T00:00:00.000Z",
        actual_induction_end_date: "2025-03-19T00:00:00.000Z",
        actual_training_start_date: "2025-03-20T00:00:00.000Z"
      }
    ];

    // Format date to IST
    function formatToIST(dateString) {
      try {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        // Format to YYYY-MM-DD
        return date.toISOString().split('T')[0];
      } catch (error) {
        console.error('Error formatting date to IST:', error);
        return dateString || 'N/A';
      }
    }

    // Export function
    function exportBatches() {
      try {
        // Map batch data
        const batchesDataToExport = batches.map(batch => ({
          'Batch ID': batch.id,
          'Batch Name': batch.name,
          'Status': batch.status,
          'Capacity Limit': batch.capacityLimit,
          'Location': batch.location ? batch.location.name : 'N/A',
          'Process': batch.process ? batch.process.name : 'N/A',
          'Line of Business': batch.line_of_business ? batch.line_of_business.name : 'N/A',
          'Start Date': batch.startDate ? formatToIST(batch.startDate) : 'N/A',
          'Induction Start': batch.inductionStartDate ? formatToIST(batch.inductionStartDate) : 'N/A',
          'Induction End': batch.inductionEndDate ? formatToIST(batch.inductionEndDate) : 'N/A',
          'Training Start': batch.trainingStartDate ? formatToIST(batch.trainingStartDate) : 'N/A',
          'Training End': batch.trainingEndDate ? formatToIST(batch.trainingEndDate) : 'N/A',
          'Actual Induction Start': batch.actual_induction_start_date ? formatToIST(batch.actual_induction_start_date) : 'N/A',
          'Actual Induction End': batch.actual_induction_end_date ? formatToIST(batch.actual_induction_end_date) : 'N/A',
          'Actual Training Start': batch.actual_training_start_date ? formatToIST(batch.actual_training_start_date) : 'N/A'
        }));

        // Create workbook
        const wb = XLSX.utils.book_new();
        const wsBatches = XLSX.utils.json_to_sheet(batchesDataToExport);
        XLSX.utils.book_append_sheet(wb, wsBatches, "Batches");
        
        // Save the file
        XLSX.writeFile(wb, `batches_export_test.xlsx`);
        
        // Show success message
        document.getElementById('status').textContent = "Export Successful!";
      } catch (error) {
        console.error("Error exporting to Excel:", error);
        document.getElementById('status').textContent = "Export Failed: " + error.message;
      }
    }
  </script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    button {
      padding: 10px 15px;
      background-color: #4466ff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .status {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Test Batch Export</h1>
  <p>Click the button below to test exporting batch data to Excel:</p>
  
  <button onclick="exportBatches()">Export to Excel</button>
  
  <div class="status" id="status"></div>
  
  <h2>Sample Data:</h2>
  <pre id="data">
  </pre>
  
  <script>
    // Display the sample data for reference
    document.getElementById('data').textContent = JSON.stringify(batches, null, 2);
  </script>
</body>
</html>